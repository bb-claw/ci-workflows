name: Smoke Test
description: Extensible smoke test runner â€” bash-based with per-repo customization

inputs:
  test-command:
    description: "Custom test command (overrides default and test-script)"
    required: false
    default: ""
  test-script:
    description: "Path to custom smoke test script (used if test-command empty)"
    required: false
    default: "scripts/smoke.sh"
  package-manager:
    description: "Package manager context (npm, pnpm, yarn) for default fallback"
    required: false
    default: "npm"

runs:
  using: composite
  steps:
    - name: Run smoke tests
      shell: bash
      run: |
        set -euo pipefail

        # Priority 1: Explicit test-command
        if [[ -n "${{ inputs.test-command }}" ]]; then
          echo "ğŸ§ª Running custom test command..."
          eval "${{ inputs.test-command }}"
          exit $?
        fi

        # Priority 2: Repository-specific smoke test script
        if [[ -f "${{ inputs.test-script }}" ]]; then
          echo "ğŸ§ª Running custom smoke test script: ${{ inputs.test-script }}"
          bash "${{ inputs.test-script }}"
          exit $?
        fi

        # Priority 3: Default basic smoke test (all repos)
        echo "ğŸ§ª Running default basic smoke test..."
        {
          echo "## Smoke Test Results"
          echo ""
          echo "| Check | Status |"
          echo "|-------|--------|"

          # Basic structure checks
          if [[ -f package.json ]]; then
            echo "| package.json | âœ… |"
          else
            echo "| package.json | âŒ Missing |"
            exit 1
          fi

          if [[ -d src ]]; then
            echo "| src/ directory | âœ… |"
          else
            echo "| src/ directory | âš ï¸ (optional) |"
          fi

          echo "| Basic smoke test | âœ… |"
          echo ""
          echo "All checks passed!"
        } | tee -a "$GITHUB_STEP_SUMMARY"
